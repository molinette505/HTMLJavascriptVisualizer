<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
    <title>Visualiseur JS Mobile v3.9.3</title>
</head>
<body>

    <div class="toolbar">
        <div class="toolbar-main">
            <div class="toolbar-group execution-controls">
                <!-- Icones Lucide mises à jour -->
                <button id="btn-toggle-run" class="icon-btn" onclick="app.toggleRun()"><i data-lucide="play"></i></button>
                <button id="btn-next" class="icon-btn" onclick="app.stepAnimated()" disabled><i data-lucide="step-forward"></i></button>
                <button id="btn-skip" class="icon-btn" onclick="app.stepInstant()" disabled><i data-lucide="skip-forward"></i></button>
            </div>
            <div class="toolbar-separator" aria-hidden="true"></div>
            <div class="toolbar-group event-controls">
                <button id="btn-trigger" class="icon-btn" onclick="app.triggerEvent()" disabled title="Déclencher l'événement"><i data-lucide="mouse-pointer-click"></i></button>
                <button id="btn-set-event" class="icon-btn" onclick="app.toggleEventPopup()" title="Nom de la fonction événement"><i data-lucide="pencil"></i></button>
                <button id="btn-load" class="icon-btn" onclick="app.toggleLoadPopup()" title="Charger une sauvegarde"><i data-lucide="folder-open"></i></button>
            </div>
        </div>
        <div class="settings-group">
            <div class="control-group">
                <span>Vit.</span>
                <button class="speed-btn" onclick="ui.adjustSpeed(-1)">−</button>
                <div id="speed-display">1x</div>
                <button class="speed-btn" onclick="ui.adjustSpeed(1)">+</button>
            </div>
            <div class="control-group">
                <span>Ligne</span>
                <button id="btn-toggle-flow-line" class="toggle-btn is-on" onclick="ui.toggleFlowLine()">ON</button>
            </div>
        </div>
        
        <!-- Popup pour le nom de l'événement -->
        <div id="event-popup" class="event-popup">
            <input type="text" id="event-name-input" value="onClick" placeholder="Nom de la fonction">
            <button onclick="app.saveEventName()">OK</button>
        </div>

        <div id="load-popup" class="event-popup load-popup">
            <span class="load-label">Scenarios (JS / HTML)</span>
            <select id="load-scenario-select"></select>
            <button onclick="app.loadSelectedScenario()">Load</button>
            <button class="btn-secondary" onclick="app.toggleLoadPopup()">Fermer</button>
        </div>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="main-container" id="main-container">
        <div class="editor-container">
            <!-- Numéros de lignes (séparé du scroll wrapper) -->
            <div class="line-numbers" id="line-numbers">1</div>
            
            <!-- Zone scrollable -->
            <div class="code-wrapper" id="code-wrapper" onscroll="ui.syncScroll()">
                <div class="code-sizer">
                    <div id="highlight-layer" class="code-layer"></div>
                    <div id="code-display" class="code-layer"></div>
                    <!-- FIX 3: inputmode="text" and autocapitalize="off" to suppress helpers -->
                    <textarea id="code-input" class="code-layer" spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" inputmode="text" oninput="editor.handleInput()" onfocus="ui.showMobileTools()" onblur="ui.hideMobileTools()"></textarea>
                </div>
            </div>
            
            <!-- MOBILE TOOLBAR -->
            <div id="mobile-tools-container" class="mobile-tools-container">
                <div id="sub-toolbar" class="toolbar-row sub-toolbar hidden"></div>
                <div id="main-toolbar" class="toolbar-row main-toolbar">
                    <button class="tool-btn btn-text-sm" onmousedown="event.preventDefault()" onclick="editor.insertText('  ', false, true)">Tab</button>
                    <button class="tool-btn" onmousedown="event.preventDefault()" onclick="editor.insertText(' = ', false, true)">=</button>
                    <button class="tool-btn" onmousedown="event.preventDefault()" onclick="editor.insertText(';', false, true)">;</button>
                    <div class="tool-spacer"></div>
                    <button class="tool-btn" id="btn-cat-brackets" onmousedown="event.preventDefault()" onclick="ui.toggleSubTool('brackets', event)">
                        ( )<span class="tool-label">•</span>
                    </button>
                    <button class="tool-btn" id="btn-cat-math" onmousedown="event.preventDefault()" onclick="ui.toggleSubTool('math', event)">
                        +/-<span class="tool-label">•</span>
                    </button>
                    <button class="tool-btn" id="btn-cat-logic" onmousedown="event.preventDefault()" onclick="ui.toggleSubTool('logic', event)">
                        &lt;&gt;<span class="tool-label">•</span>
                    </button>
                    <div class="tool-spacer"></div>
                    <button class="tool-btn" onmousedown="event.preventDefault()" onclick="editor.undo(event)">↶</button>
                    <button class="tool-btn" onmousedown="event.preventDefault()" onclick="editor.redo(event)">↷</button>
                </div>
            </div>
        </div>

        <div class="right-panel" id="right-panel">
            <div class="drawer-handle-bar" id="drawer-handle">
                <div class="drawer-handle-icon"></div>
            </div>
            <div class="drawer-tabs">
                <div class="drawer-tab active" onclick="ui.switchTab('memory')" id="tab-memory">Mémoire</div>
                <div class="drawer-tab" onclick="ui.switchTab('console')" id="tab-console">Console</div>
                <div class="drawer-tab" onclick="ui.switchTab('dom')" id="tab-dom">DOM</div>
            </div>
            <div id="view-memory" class="drawer-content active">
                <div id="memory-container"></div>
            </div>
            <div id="view-console" class="drawer-content">
                <div class="console-box" id="console-output"></div>
            </div>
            <div id="view-dom" class="drawer-content">
                <div id="dom-view-tree" class="dom-view active"></div>
            </div>
        </div>
    </div>
<script type="module" src="/src/main.ts"></script>
</body>
</html>
